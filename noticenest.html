<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NoticeNest App</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Lobster&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet" />
  <style>
    /* Ensure anything with [hidden] truly stays hidden */
    [hidden] { display: none !important; }

    /* Reset and base */
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Roboto", sans-serif;
      min-height: 100vh;
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: background-color 0.3s, color 0.3s;
    }
    :root {
      --bg-color: #121212;
      --text-color: #e0e0e0;
      --primary-color: #00bcd4;
      --secondary-color: #8e8e93;
      --nav-bg: #2c2c2e;
      --card-bg: rgba(255 255 255 / 0.1);
      --card-border: rgba(255 255 255 / 0.2);
      --shadow-color: rgba(0 0 0 / 0.5);
      /* NEW: Added a separate, solid background color for the modal */
      --modal-bg: #2c2c2e;
    }
    .light-theme {
      --bg-color: #f0f2f5;
      --text-color: #202020;
      --primary-color: #007a99;
      --secondary-color: #606060;
      --nav-bg: #fff;
      --card-bg: #ffffff;
      --card-border: rgba(0 0 0 / 0.1);
      --shadow-color: rgba(0 0 0 / 0.1);
      /* NEW: Solid white for the modal in light mode */
      --modal-bg: #ffffff;
    }
    button { cursor: pointer; }
    a { text-decoration: none; color: inherit; }

    /* Containers and layouts */
    .app-container {
      width: 100%;
      min-height: 100vh;
      margin: 0 auto;
      background: var(--bg-color);
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
      position: relative;
      color: var(--text-color);
      transition: background-color 0.3s, color 0.3s;
    }
    header {
      padding: 20px 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header h1 { margin: 0; font-size: 24px; font-weight: 500; color: var(--text-color); }
    .settings-icon { font-size: 22px; color: var(--secondary-color); cursor: pointer; position: relative; }
    .settings-menu {
      position: absolute; top: 60px; right: 25px;
      background: var(--card-bg);
      border-radius: 12px; border: 1px solid var(--card-border);
      box-shadow: 0 8px 32px var(--shadow-color);
      padding: 10px 15px; display: none; flex-direction: column; gap: 10px; z-index: 1000;
    }
    .settings-menu.active { display: flex; }
    .settings-menu button {
      background: none; border: none; padding: 8px 10px; text-align: left; font-size: 14px; color: var(--text-color);
      width: 100%; border-radius: 8px; transition: background-color 0.2s;
    }
    .settings-menu button:hover { background-color: var(--primary-color); color: #fff; }

    /* Login page */
    #login-page {
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      flex-grow: 1; padding: 50px 20px; text-align: center;
    }
    #login-logo i { font-size: 64px; color: var(--primary-color); margin-bottom: 12px; }
    #login-title { font-family: 'Lobster', cursive; font-size: 48px; margin: 0 0 40px 0; color: var(--text-color); }
    .login-buttons { display: flex; flex-direction: column; /* MODIFIED: Column for better stacking */ gap: 20px; flex-wrap: wrap; justify-content: center; }
    .login-buttons button {
      background: var(--primary-color); border: none; border-radius: 30px; padding: 14px 28px; font-size: 18px; color: #fff; font-weight: 600;
      box-shadow: 0 8px 24px rgba(0, 188, 212, 0.5); transition: background-color 0.3s; min-width: 200px;
    }
    .login-buttons button:hover { background: #0097a7; }
    /* NEW: Style for the admin button */
    #admin-login-btn { background-color: #c2185b; box-shadow: 0 8px 24px #c2185b80; }
    #admin-login-btn:hover { background-color: #a0144b; }


    /* Search Bar */
    .search-section { padding: 0 25px 20px 25px; display: none; }
    .search-section.visible { display: block; }
    .search-bar-container { position: relative; width: 100%; max-width: 600px; margin: 0 auto; }
    .search-bar {
      width: 100%; padding: 12px 40px 12px 16px; background-color: #2c2c2e; color: #fff; font-size: 16px; border: none; border-radius: 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08); outline: none; transition: box-shadow 0.2s;
    }
    .search-bar:focus { box-shadow: 0 2px 12px #00bcd433; }
    .search-icon {
      position: absolute; right: 14px; top: 50%; transform: translateY(-50%); font-size: 20px; color: #8e8e93; pointer-events: none;
    }

    main {
      flex-grow: 1; overflow-y: auto; padding: 0 0 80px 0;
      background: url('https://www.transparenttextures.com/patterns/dark-matter.png');
      display: flex; flex-direction: column; align-items: center;
    }

    .content-list-wrapper {
      width: 90%;
      max-width: 800px;
    }

    /* Profile Card */
    .profile-card {
      width: 90%; max-width: 800px;
      background: var(--card-bg); border-radius: 20px; backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
      border: 1px solid var(--card-border); box-shadow: 0 8px 32px var(--shadow-color);
      display: flex; align-items: center; gap: 15px; padding: 20px; text-align: left; margin: 20px 0; color: var(--text-color);
    }
    .profile-pic { width: 80px; height: 80px; border-radius: 50%; border: 2px solid rgba(255 255 255 / 0.5); flex-shrink: 0; }
    .profile-text { display: flex; flex-direction: column; flex-grow: 1; }
    .profile-text h2 { margin: 0 0 5px 0; font-weight: 500; font-size: 20px; }
    .profile-text .role { margin: 0 0 10px 0; font-size: 14px; color: var(--primary-color); font-weight: 300; }
    .profile-text .quote { font-size: 14px; font-style: italic; color: var(--secondary-color); }

    /* Branding */
    .branding { display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 30px; }
    .logo-placeholder {
      width: 60px; height: 60px; background: var(--card-bg); border-radius: 50%;
      display: flex; align-items: center; justify-content: center; font-size: 30px; color: var(--primary-color); border: 1px solid var(--card-border);
    }
    .brand-text { text-align: left; color: var(--text-color); }
    .stylish-title { font-family: 'Lobster', cursive; font-size: 42px; margin: 0; line-height: 1; }
    .latin-quote { font-size: 12px; color: var(--secondary-color); font-style: italic; margin-top: 5px; }

    /* Home Tiles */
    .home-tiles {
      width: 90%; max-width: 900px;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px; margin-bottom: 30px;
    }
    .tile {
      background: var(--card-bg); border-radius: 20px; padding: 20px; cursor: pointer; box-shadow: 0 8px 32px var(--shadow-color);
      display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 10px; min-height: 120px;
      transition: all 0.3s ease;
      color: var(--text-color); font-weight: 500; font-size: 18px; user-select: none;
    }
    .tile:hover, .tile:focus { background: var(--primary-color); color: white; transform: translateY(-5px); outline: none; }
    .tile i { font-size: 36px; color: var(--primary-color); transition: color 0.3s ease; }
    .tile:hover i, .tile:focus i { color: white; }

    /* Bottom Navigation */
    nav.bottom-nav {
      position: fixed;
      bottom: 0; left: 0;
      width: 100%; height: 60px; background: var(--nav-bg);
      border-top: 1px solid var(--card-border); display: flex; justify-content: space-around; align-items: center;
      z-index: 10; transition: background-color 0.3s;
    }
    .nav-item {
      display: flex; flex-direction: column; align-items: center; color: var(--secondary-color); font-size: 12px; cursor: pointer;
      text-decoration: none; flex: 1; justify-content: center; padding: 5px 0; transition: color 0.2s; user-select: none;
    }
    .nav-item i { font-size: 22px; margin-bottom: 5px; }
    .nav-item.active, .nav-item:hover { color: var(--primary-color); }
    .nav-item.home { flex: 1.2; }
    .nav-item.home i { font-size: 28px; }

    /* Content pages */
    section.page { display: none; width: 100%; flex-grow: 1; overflow-y: auto; padding: 20px 0 100px; flex-direction: column; align-items: center; }
    section.page.active { display: flex; }

    /* Notices, Announcements, Nudges list styles */
    .list-header { display: flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 15px; color: var(--text-color); }
    .btn-create {
      background-color: var(--primary-color); border: none; color: #fff; padding: 8px 15px; border-radius: 25px; font-weight: 500;
      cursor: pointer; transition: background-color 0.3s ease; user-select: none;
    }
    .btn-create:hover { background-color: #0097a7; }
    .tiles-list, .complaints-list { display: flex; flex-direction: column; gap: 12px; width: 100%; }
    .tile-item {
      background-color: var(--card-bg); padding: 15px 20px; border-radius: 16px; cursor: pointer; transition: background-color 0.3s ease;
      font-size: 16px; font-weight: 500; color: var(--text-color); display: flex; justify-content: space-between; align-items: center; user-select: none;
    }
    .tile-item:hover, .tile-item:focus { background-color: var(--primary-color); color: white; outline: none; }
    .tile-item .date { font-size: 12px; color: var(--secondary-color); margin-left: 12px; white-space: nowrap; }

    /* Modal styles */
    .modal-backdrop {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7);
      backdrop-filter: blur(5px); /* MODIFIED: Soft blur on the background */
      display: none; justify-content: center; align-items: center; z-index: 999;
    }
    .modal-backdrop.active { display: flex; }
    .modal-content {
      /* MODIFIED: Use the new solid background color and remove backdrop-filter */
      background-color: var(--modal-bg);
      border-radius: 25px; width: 90%; max-width: 600px;
      padding: 25px 25px 30px; color: var(--text-color);
      max-height: 80vh; overflow-y: auto; box-shadow: 0 8px 32px var(--shadow-color); position: relative;
    }
    .modal-close { position: absolute; right: 15px; top: 15px; font-size: 22px; color: var(--secondary-color); cursor: pointer; user-select: none; }
    .modal-close:hover { color: var(--primary-color); }
    .modal-title { font-weight: 600; font-size: 22px; margin-bottom: 15px; }
    .modal-date { font-size: 14px; color: var(--primary-color); margin-bottom: 15px; }
    .modal-text { font-size: 16px; line-height: 1.5; white-space: pre-wrap; }

    /* Nudges */
    .complaint-submit { margin-bottom: 15px; display: flex; gap: 10px; width: 100%; }
    .complaint-submit input {
      flex-grow: 1; padding: 10px; border-radius: 25px; border: none; background: var(--nav-bg); color: var(--text-color); font-size: 14px;
    }
    .complaint-submit input::placeholder { color: var(--secondary-color); }
    .complaint-submit button {
      border: none; background: var(--primary-color); color: #fff; padding: 0 20px; border-radius: 25px; font-weight: 500; cursor: pointer;
      transition: background-color 0.3s ease; user-select: none;
    }
    .complaint-submit button:hover { background: #0097a7; }
    .complaint-item { background: var(--card-bg); padding: 15px 20px; border-radius: 16px; cursor: pointer; font-size: 16px; font-style: italic; color: var(--text-color); }

    /* Rules/Decreta */
    .rules-list {
      width: 100%; max-height: 70vh; overflow-y: auto; background: var(--card-bg); border-radius: 16px; padding: 15px 20px;
      color: var(--text-color); font-size: 16px; line-height: 1.4; margin-bottom: 30px;
    }
    .rule-item { margin-bottom: 12px; }
    .rules-footer { margin-top: 15px; font-style: italic; color: var(--primary-color); text-align: center; margin-bottom: 40px; }

    /* NEW: Styles for the Admin User Management Page */
    .user-list { display: flex; flex-direction: column; gap: 12px; width: 100%; }
    .user-item {
        background-color: var(--card-bg);
        padding: 15px 20px;
        border-radius: 16px;
        font-size: 16px;
        color: var(--text-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .user-item .role {
        font-size: 12px;
        color: var(--primary-color);
        background-color: var(--nav-bg);
        padding: 4px 8px;
        border-radius: 10px;
        text-transform: capitalize;
    }
    .user-item .remove-user-btn {
        background-color: #c2185b;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
        cursor: pointer;
    }


    /* Desktop & Tablet Styles */
    @media (min-width: 768px) {
      body {
        padding: 20px;
      }
      .app-container {
        border-radius: 30px;
        box-shadow: 0 10px 40px var(--shadow-color);
        border: 2px solid var(--card-border);
        max-width: 1200px;
        height: 90vh;
        max-height: 850px;
      }
      nav.bottom-nav {
        position: absolute;
        border-bottom-left-radius: 30px;
        border-bottom-right-radius: 30px;
      }
      .home-tiles {
        grid-template-columns: repeat(4, 1fr);
      }
      .login-buttons {
        flex-direction: row; /* MODIFIED: Row on desktop */
      }
    }
  </style>
</head>
<body>
  <div class="app-container light-theme" id="app">
    <section id="login-page" role="main" aria-label="Login page">
      <div id="login-logo" aria-hidden="true"><i class="fas fa-feather-alt"></i></div>
      <h1 id="login-title">NoticeNest</h1>
      <div class="login-buttons" role="group" aria-label="Login options">
        <button id="teacher-login-btn">Teacher Login</button>
        <button id="student-login-btn">Student Login</button>
        <button id="admin-login-btn">Admin Login</button>
      </div>
    </section>

    <header aria-label="App Header" hidden>
      <h1>NoticeNest</h1>
      <i class="fas fa-cog settings-icon" id="settings-btn" tabindex="0" role="button" aria-haspopup="true" aria-expanded="false" aria-controls="settings-menu"></i>
      <div id="settings-menu" class="settings-menu" role="menu" aria-hidden="true" aria-labelledby="settings-btn">
        <button id="theme-toggle-btn" role="menuitem">Light Mode</button>
        <button id="logout-btn" role="menuitem">Logout</button>
      </div>
    </header>

    <div class="search-section" id="searchSection" hidden>
      <div class="search-bar-container">
        <input type="text" class="search-bar" id="searchInput" placeholder="Search Notices or People..." aria-label="Search Notices or People" />
        <span class="search-icon"><i class="fas fa-search"></i></span>
      </div>
    </div>

    <main hidden>
      <section id="page-home" class="page active" aria-label="Home Page">
        <div class="profile-card" role="region" aria-label="User Profile">
          <img src="https://i.pravatar.cc/150?u=a042581f4e29026704d" alt="Profile Picture" class="profile-pic" width="80" height="80" decoding="async" />
          <div class="profile-text">
            <h2 id="profile-name">Alex Johnson</h2>
            <p class="role" id="profile-role">Student Representative</p>
            <p class="quote">"The art of communication is the language of leadership."</p>
          </div>
        </div>

        <div class="branding">
          <div class="logo-placeholder" aria-hidden="true"><i class="fas fa-feather-alt"></i></div>
          <div class="brand-text">
            <h1 class="stylish-title">NoticeNest</h1>
            <p class="latin-quote">Verba volant, scripta manent.</p>
          </div>
        </div>

        <div class="home-tiles" role="navigation" aria-label="Main Navigation Tiles">
          <div class="tile" tabindex="0" data-target="page-notice"><i class="fas fa-bell"></i><span>Notice</span></div>
          <div class="tile" tabindex="0" data-target="page-announcements"><i class="fas fa-bullhorn"></i><span>Announcements</span></div>
          <div class="tile" tabindex="0" data-target="page-nudges"><i class="fas fa-flag"></i><span>Nudges</span></div>
          <div class="tile" tabindex="0" data-target="page-decreta"><i class="fas fa-scroll"></i><span>Decreta</span></div>
        </div>
      </section>

      <section id="page-notice" class="page" aria-label="Notice Page">
        <div class="content-list-wrapper">
          <div class="list-header">
            <h2>Notices</h2>
            <button class="btn-create" id="create-notice-btn">+ New Notice</button>
          </div>
          <div class="tiles-list" id="notice-list"></div>
        </div>
      </section>

      <section id="page-announcements" class="page" aria-label="Announcements Page">
        <div class="content-list-wrapper">
          <div class="list-header">
            <h2>Announcements</h2>
            <button class="btn-create" id="create-announcement-btn">+ New Announcement</button>
          </div>
          <div class="tiles-list" id="announcement-list"></div>
        </div>
      </section>

      <section id="page-nudges" class="page" aria-label="Nudges Page">
        <div class="content-list-wrapper">
          <div class="complaint-submit">
            <input type="text" id="complaint-input" placeholder="Submit anonymous complaint..." aria-label="Enter complaint here" />
            <button id="complaint-submit-btn">Submit</button>
          </div>
          <div class="complaints-list" id="complaints-list"></div>
        </div>
      </section>

      <section id="page-decreta" class="page" aria-label="Decreta Page">
        <div class="content-list-wrapper">
          <h2>College Rules and Regulations</h2>
          <div class="rules-list" id="rules-list">
            <div class="rule-item">Rule 1: Respect everyone on campus and maintain decorum.</div>
            <div class="rule-item">Rule 2: Follow all class schedules and attend lectures punctually.</div>
            <div class="rule-item">Rule 3: Maintain cleanliness in classrooms, labs, and common areas.</div>
            <div class="rule-item">Rule 4: Use mobile phones only during breaks and avoid disruptions.</div>
            <div class="rule-item">Rule 5: Cooperate with campus staff and security personnel.</div>
          </div>
          <div class="rules-footer">Disciplina est fundamentum progressionis.</div>
        </div>
      </section>
      
      <section id="page-admin" class="page" aria-label="Admin Page">
          <div class="content-list-wrapper">
              <div class="list-header">
                  <h2>User Management</h2>
                  <button class="btn-create" id="add-user-btn">+ Add User</button>
              </div>
              <div class="user-list" id="user-list">
                  </div>
          </div>
      </section>
    </main>

    <nav class="bottom-nav" role="navigation" aria-label="Main Navigation" hidden>
      <a href="#" class="nav-item" data-target="page-notice" aria-label="Notice tab"><i class="fas fa-bell"></i><span>Notice</span></a>
      <a href="#" class="nav-item" data-target="page-announcements" aria-label="Announcements tab"><i class="fas fa-bullhorn"></i><span>Announcements</span></a>
      <a href="#" class="nav-item home active" data-target="page-home" aria-label="Home tab"><i class="fas fa-home"></i><span>Home</span></a>
      <a href="#" class="nav-item" data-target="page-nudges" aria-label="Nudges tab"><i class="fas fa-flag"></i><span>Nudges</span></a>
      <a href="#" class="nav-item" data-target="page-decreta" aria-label="Decreta tab"><i class="fas fa-scroll"></i><span>Decreta</span></a>
      <a href="#" class="nav-item" data-target="page-admin" id="nav-admin" aria-label="Admin tab" hidden><i class="fas fa-user-shield"></i><span>Admin</span></a>
    </nav>

    <div class="modal-backdrop" id="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="modal-title" tabindex="-1">
      <div class="modal-content" tabindex="0">
        <button class="modal-close" aria-label="Close">&times;</button>
        <h3 class="modal-title" id="modal-title"></h3>
        <div class="modal-date"></div>
        <div class="modal-text"></div>
      </div>
    </div>
  </div>

  <script>
    // =================================================================
    // JAVASCRIPT (NEW AND MODIFIED SECTIONS ARE COMMENTED)
    // =================================================================
    const app = document.getElementById('app');
    const loginPage = document.getElementById('login-page');
    const header = app.querySelector('header');
    const searchSection = document.getElementById('searchSection');
    const searchInput = document.getElementById('searchInput');
    const main = app.querySelector('main');
    const bottomNav = app.querySelector('nav.bottom-nav');
    const settingsBtn = document.getElementById('settings-btn');
    const settingsMenu = document.getElementById('settings-menu');
    const themeToggleBtn = document.getElementById('theme-toggle-btn');
    const logoutBtn = document.getElementById('logout-btn');

    const navItems = document.querySelectorAll('.nav-item');
    const pages = document.querySelectorAll('.page');
    const homeTiles = document.querySelectorAll('.home-tiles .tile');

    // Modal
    const modal = document.getElementById('modal-backdrop');
    const modalTitle = modal.querySelector('.modal-title');
    const modalDate = modal.querySelector('.modal-date');
    const modalText = modal.querySelector('.modal-text');
    const modalCloseBtn = modal.querySelector('.modal-close');

    // Login buttons
    const teacherLoginBtn = document.getElementById('teacher-login-btn');
    const studentLoginBtn = document.getElementById('student-login-btn');
    const adminLoginBtn = document.getElementById('admin-login-btn'); // NEW

    // NEW: Admin page elements
    const userList = document.getElementById('user-list');
    const addUserBtn = document.getElementById('add-user-btn');

    // ==================
    // DATA
    // ==================
    // NEW: Variable to store the current user's role
    let currentUserRole = null;

    // NEW: User data store
    let users = [
        { id: 1, name: 'Dr. Evelyn Reed', role: 'teacher' },
        { id: 2, name: 'Alex Johnson', role: 'student' },
        { id: 3, name: 'Ben Carter', role: 'student' },
        { id: 4, name: 'Admin User', role: 'admin' },
    ];
    let notices = [
      {id:1, title:"Semester Break Announcement", date:"2025-08-20", content:"Semester break starts from August 25 to September 10."},
      {id:2, title:"Library Timings Update", date:"2025-08-22", content:"Library will now open from 8am to 8pm on weekdays."}
    ];
    let announcements = [
      {id:1, title:"Guest Lecture on AI", date:"2025-08-18", content:"Join us for a guest lecture on Artificial Intelligence this Friday."},
      {id:2, title:"Sports Meet", date:"2025-08-21", content:"Annual sports meet is scheduled for September 5th."}
    ];
    let complaints = [];

    // ==================
    // LOGIN & PERMISSIONS
    // ==================
    // NEW: Function to set UI visibility based on user role
    function updateUIPermissions() {
        const createButtons = document.querySelectorAll('.btn-create');
        const adminNav = document.getElementById('nav-admin');
        const profileName = document.getElementById('profile-name');
        const profileRole = document.getElementById('profile-role');

        // Hide all create buttons for students
        const canCreate = (currentUserRole === 'admin' || currentUserRole === 'teacher');
        createButtons.forEach(btn => btn.hidden = !canCreate);

        // Show admin tab only for admins
        adminNav.hidden = (currentUserRole !== 'admin');

        // Update profile card based on role
        if (currentUserRole === 'admin') {
            profileName.textContent = 'Admin';
            profileRole.textContent = 'System Administrator';
        } else if (currentUserRole === 'teacher') {
            profileName.textContent = 'Dr. Evelyn Reed';
            profileRole.textContent = 'Professor of Computer Science';
        } else {
            profileName.textContent = 'Alex Johnson';
            profileRole.textContent = 'Student Representative';
        }
    }

    // MODIFIED: Centralized login function
    function loginAs(role) {
        currentUserRole = role;
        loginPage.hidden = true;
        header.hidden = false;
        main.hidden = false;
        bottomNav.hidden = false;
        searchSection.hidden = false;
        searchSection.classList.remove('visible');

        updateUIPermissions();
        switchPage('page-home');
    }

    teacherLoginBtn.onclick = () => loginAs('teacher');
    studentLoginBtn.onclick = () => loginAs('student');
    adminLoginBtn.onclick = () => loginAs('admin');


    // ==================
    // PAGE NAVIGATION
    // ==================
    function switchPage(pageId) {
      // NEW: Prevent non-admins from accessing the admin page
      if (pageId === 'page-admin' && currentUserRole !== 'admin') {
        pageId = 'page-home'; // Redirect to home
      }

      pages.forEach(p => p.classList.toggle('active', p.id === pageId));
      navItems.forEach(n => n.classList.toggle('active', n.dataset.target === pageId));

      if (["page-notice", "page-announcements", "page-nudges"].includes(pageId)) {
        searchSection.classList.add('visible');
        searchInput.value = "";
      } else {
        searchSection.classList.remove('visible');
        searchInput.value = "";
      }

      settingsMenu.classList.remove('active');
      settingsBtn?.setAttribute('aria-expanded', 'false');
      settingsMenu?.setAttribute('aria-hidden', 'true');
    }

    navItems.forEach((nav) => {
      nav.addEventListener('click', e => {
        e.preventDefault();
        switchPage(nav.dataset.target);
      });
    });

    homeTiles.forEach(tile => {
      tile.addEventListener('click', () => switchPage(tile.dataset.target));
      tile.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); switchPage(tile.dataset.target); }
      });
    });

    // ==================
    // MODAL
    // ==================
    function openModal(item) {
      modalTitle.textContent = item.title;
      modalDate.textContent = item.date;
      modalText.textContent = item.content;
      modal.classList.add('active');
      modal.focus();
    }
    modalCloseBtn.addEventListener('click', () => modal.classList.remove('active'));
    modal.addEventListener('click', e => { if (e.target === modal) modal.classList.remove('active'); });

    // ==================
    // RENDER FUNCTIONS
    // ==================
    const noticeList = document.getElementById('notice-list');
    const announcementList = document.getElementById('announcement-list');

    function renderTiles(listElem, items) {
      listElem.innerHTML = '';
      items.forEach(item => {
        const div = document.createElement('div');
        div.classList.add('tile-item');
        div.tabIndex = 0;
        div.dataset.id = item.id;
        div.textContent = item.title;
        const dateSpan = document.createElement('div');
        dateSpan.className = 'date';
        dateSpan.textContent = item.date;
        div.appendChild(dateSpan);
        div.addEventListener('click', () => openModal(item));
        div.addEventListener('keydown', e => { if(e.key === 'Enter' || e.key === ' ') openModal(item); });
        listElem.appendChild(div);
      });
    }

    // ==================
    // CREATE/SUBMIT ACTIONS
    // ==================
    document.getElementById('create-notice-btn').addEventListener('click', () => {
      let title = prompt("Enter Notice Title:"); if(!title) return;
      let content = prompt("Enter full notice content:"); if(!content) return;
      let date = new Date().toISOString().slice(0,10);
      notices.unshift({id:Date.now(), title, date, content});
      renderTiles(noticeList, notices);
      alert("Notice added!");
    });

    document.getElementById('create-announcement-btn').addEventListener('click', () => {
      let title = prompt("Enter Announcement Title:"); if(!title) return;
      let content = prompt("Enter full announcement content:"); if(!content) return;
      let date = new Date().toISOString().slice(0,10);
      announcements.unshift({id:Date.now(), title, date, content});
      renderTiles(announcementList, announcements);
      alert("Announcement added!");
    });

    const complaintsList = document.getElementById('complaints-list');
    const complaintInput = document.getElementById('complaint-input');
    const complaintSubmitBtn = document.getElementById('complaint-submit-btn');

    complaintSubmitBtn.addEventListener('click', () => {
      const text = complaintInput.value.trim();
      if(!text) return alert("Please enter a complaint.");
      complaints.unshift({id:Date.now(), text, support:0, protest:0, userChoice:null});
      complaintInput.value = '';
      renderComplaints();
    });

    function renderComplaints() {
      complaintsList.innerHTML = '';
      complaints.forEach(c => {
        const div = document.createElement('div');
        div.className = 'complaint-item';
        div.textContent = c.text;

        const actions = document.createElement('div');
        actions.className = 'complaint-actions';
        Object.assign(actions.style, {display:'flex', gap:'20px', marginTop:'10px'});

        const supportBtn = document.createElement('button');
        supportBtn.innerHTML = '👍';
        supportBtn.setAttribute('aria-label', 'Support complaint');
        supportBtn.classList.toggle('supported', c.userChoice === 'support');
        supportBtn.addEventListener('click', () => {
          if(c.userChoice === 'support'){ c.userChoice = null; c.support--; }
          else { if(c.userChoice === 'protest') c.protest--; c.userChoice = 'support'; c.support++; }
          renderComplaints();
        });
        const supportCount = document.createElement('span'); supportCount.textContent = ' ' + c.support; supportBtn.appendChild(supportCount);

        const protestBtn = document.createElement('button');
        protestBtn.innerHTML = '💢';
        protestBtn.setAttribute('aria-label', 'Protest complaint');
        protestBtn.classList.toggle('protested', c.userChoice === 'protest');
        protestBtn.addEventListener('click', () => {
          if(c.userChoice === 'protest'){ c.userChoice = null; c.protest--; }
          else { if(c.userChoice === 'support') c.support--; c.userChoice = 'protest'; c.protest++; }
          renderComplaints();
        });
        const protestCount = document.createElement('span'); protestCount.textContent = ' ' + c.protest; protestBtn.appendChild(protestCount);

        actions.appendChild(supportBtn);
        actions.appendChild(protestBtn);
        div.appendChild(actions);
        complaintsList.appendChild(div);
      });
    }

    // ==================================
    // NEW: ADMIN USER MANAGEMENT FUNCTIONS
    // ==================================
    function renderUsers() {
        userList.innerHTML = ''; // Clear the list before rendering
        users.forEach(user => {
            const item = document.createElement('div');
            item.className = 'user-item';
            item.innerHTML = `
                <div>
                    <strong>${user.name}</strong>
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span class="role">${user.role}</span>
                    <button class="remove-user-btn" data-id="${user.id}">Remove</button>
                </div>
            `;
            userList.appendChild(item);
        });
    }

    addUserBtn.addEventListener('click', () => {
        const name = prompt("Enter new user's name:");
        if (!name) return;

        let role = prompt("Enter role (student, teacher):")?.toLowerCase();
        while (role && !['student', 'teacher'].includes(role)) {
            role = prompt("Invalid role. Please enter 'student' or 'teacher':")?.toLowerCase();
        }
        if (!role) return;

        const newUser = { id: Date.now(), name, role };
        users.push(newUser);
        renderUsers(); // Re-render the list with the new user
        alert("User added!");
    });

    // Use event delegation for remove buttons
    userList.addEventListener('click', (e) => {
        if (e.target.classList.contains('remove-user-btn')) {
            const userId = parseInt(e.target.dataset.id, 10);
            if (confirm("Are you sure you want to remove this user?")) {
                users = users.filter(user => user.id !== userId);
                renderUsers(); // Re-render the list
            }
        }
    });


    // ==================
    // SETTINGS & LOGOUT
    // ==================
    settingsBtn.addEventListener('click', () => {
      const expanded = settingsBtn.getAttribute('aria-expanded') === 'true';
      settingsBtn.setAttribute('aria-expanded', String(!expanded));
      settingsMenu.classList.toggle('active');
      settingsMenu.setAttribute('aria-hidden', String(expanded));
    });

    document.addEventListener('click', (e) => {
      if(!settingsBtn.contains(e.target) && !settingsMenu.contains(e.target)) {
        settingsMenu.classList.remove('active');
        settingsBtn.setAttribute('aria-expanded', 'false');
        settingsMenu.setAttribute('aria-hidden', 'true');
      }
    });

    function setTheme(isLight) {
      if(isLight) { app.classList.add('light-theme'); themeToggleBtn.textContent = "Dark Mode"; }
      else { app.classList.remove('light-theme'); themeToggleBtn.textContent = "Light Mode"; }
      localStorage.setItem('noticenest-theme', isLight ? 'light' : 'dark');
    }
    
    logoutBtn.addEventListener('click', () => {
      currentUserRole = null; // Clear the user role
      header.hidden = true;
      main.hidden = true;
      bottomNav.hidden = true;
      searchSection.classList.remove('visible');
      searchSection.hidden = true;
      loginPage.hidden = false;
      settingsMenu.classList.remove('active');
      settingsBtn.setAttribute('aria-expanded', 'false');
      settingsMenu.setAttribute('aria-hidden', 'true');
    });
    
    // ==================
    // INITIALIZATION
    // ==================
    const savedTheme = localStorage.getItem('noticenest-theme');
    setTheme(savedTheme === 'light');
    renderTiles(noticeList, notices);
    renderTiles(announcementList, announcements);
    renderUsers(); // NEW: Initial render of the user list for the admin page

    // No search logic needed here as it's the same as before.
    // The previous search functions for tiles and complaints are still present and unchanged below.
    // ... (rest of the unchanged JS code) ...
    searchInput.addEventListener('input', function() {
      const query = searchInput.value.trim().toLowerCase();
      if (document.getElementById('page-notice').classList.contains('active')) {
        filterTiles(noticeList, notices, query);
      } else if (document.getElementById('page-announcements').classList.contains('active')) {
        filterTiles(announcementList, announcements, query);
      } else if (document.getElementById('page-nudges').classList.contains('active')) {
        filterComplaints(query);
      }
    });

    function filterTiles(listElem, items, query) {
      listElem.innerHTML = '';
      items
        .filter(item => item.title.toLowerCase().includes(query) || item.content.toLowerCase().includes(query))
        .forEach(item => {
          const div = document.createElement('div');
          div.classList.add('tile-item');
          div.tabIndex = 0;
          div.dataset.id = item.id;
          div.textContent = item.title;
          const dateSpan = document.createElement('div');
          dateSpan.className = 'date';
          dateSpan.textContent = item.date;
          div.appendChild(dateSpan);
          div.addEventListener('click', () => openModal(item));
          div.addEventListener('keydown', e => { if (e.key === 'Enter' || e.key === ' ') openModal(item); });
          listElem.appendChild(div);
        });
    }

    function filterComplaints(query) {
      complaintsList.innerHTML = '';
      complaints
        .filter(c => c.text.toLowerCase().includes(query))
        .forEach(c => {
          const div = document.createElement('div');
          div.className = 'complaint-item';
          div.textContent = c.text;
          // ... (actions buttons code remains the same)
        });
    }
  </script>
</body>
</html>